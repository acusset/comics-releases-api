<!DOCTYPE html>
<html lang="fr">
<head>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script>
    <script type="text/javascript" src="http://underscorejs.org/underscore.js"></script>
    <script type="text/javascript" src="http://backbonejs.org/backbone.js"></script>
    <script type="text/javascript" src="https://momentjs.com/downloads/moment-with-locales.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css">
    <meta charset="UTF-8">
    <title>Backbone Hello World</title>
</head>
<body class="grey lighten-3">

<nav>
    <div class="nav-wrapper red">
        <a href="#" class="brand-logo">
            <div class="container"></div>
        </a>
        <ul id="nav-mobile" class="right hide-on-med-and-down">
            <li><a href="#"></a></li>
            <li><a href="#"></a></li>
            <li><a href="#"></a></li>
        </ul>
    </div>
</nav>

<div class="container">
    <div class="row col-md-6 col-md-offset-3">
        <div id="container" class="container">
        </div>
    </div>
</div>

<script>
    var json = {};
    var container = $("#container");
    $.get('newreleases.txt', function test(data) {
        var lines = data.split('\n');
        var type = "";
        var dateRegex = /(0?[1-9]|[12][0-9]|3[01])[\/\-](0?[1-9]|1[012])[\/\-]\d{4}/g;
        var regex = /(^[A-Z]{3}[0-9]{6})\s(.+)\s\$(([0-9]+\.{1}[0-9]{2})|PI)/i;
        for (var i = 0; i < lines.length; i++) {
            var line = lines[i];
            if (!line || line.length <= 1) {
                continue;
            }
            if (i == 0) { // date
                var date = line.match(dateRegex);
//                date = date[0].split('/');
//                date = new Moment(date[2], date[0], date[1]);
                $('a.brand-logo').text("New Releases " + moment(date, "mm/dd/yyyy").format('L'));
                continue;
            }
            var values = line.match(regex);
            if (values) {
                json[type].push({
                    id: values[1],
                    title: values[2],
                    price: parseFloat(values[3])
                });
                var el = '<li class="collection-item"><span class="badge">$' + parseFloat(values[3]) + '</span><span class="title">' + values[2] + '</span></li>';
                console.log($('ul').last().append(el));
            } else if (i > 7) {
                title = line.trim();
                type = slugify(title);
                json[type] = [];
                list = '<div class="row" id="' + type + '"><ul class="collection with-header z-depth-1"><li class="collection-header"><h4>' + title + '</h4></li></ul></div>';
                container.append(list);
            }
        }
    });

    function slugify(text) {
        return text.toString().toLowerCase()
            .replace(/\s+/g, '-')           // Replace spaces with -
            .replace(/[^\w\-]+/g, '')       // Remove all non-word chars
            .replace(/\-\-+/g, '-')         // Replace multiple - with single -
            .replace(/^-+/, '')             // Trim - from start of text
            .replace(/-+$/, '');            // Trim - from end of text
    }
</script>
</body>
</html>